name: Update Zenodo downloads badge

on:
  schedule:
    - cron: "*/30 * * * *"   # every 30 minutes
  workflow_dispatch:

permissions:
  contents: write

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          ref: badge-data

      - name: Fetch Zenodo downloads and update badge.json
        run: |
          RECORD_ID="17794838"
          API="https://zenodo.org/api/records/${RECORD_ID}"

          DL=$(curl -sL "$API" | python3 -c "import sys,json; d=json.load(sys.stdin); print(d.get('stats',{}).get('unique_downloads', d.get('stats',{}).get('downloads',0)))")

          cat > badge.json <<EOF
